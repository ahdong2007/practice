
DROP table PHONE_CARRIER_INFO_LT;
DROP table PHONE_CARRIER_INFO_DX;
DROP table PHONE_CARRIER_INFO_YD;
DROP table PHONE_CARRIER_INFO_DEFAULT;
DROP TABLE PHONE_CARRIER_INFO;

CREATE TABLE PHONE_CARRIER_INFO
(
	PHONE_PREFIX VARCHAR(7),
	PROVINCE VARCHAR(64),
	CITY VARCHAR(64),
	CARRIER VARCHAR(64)
);

CREATE TABLE PHONE_CARRIER_INFO_LT
PARTITION OF PHONE_CARRIER_INFO
FOR VALUES in ('中国联通');

CREATE TABLE PHONE_CARRIER_INFO_DX
PARTITION OF PHONE_CARRIER_INFO
FOR VALUES in ('中国电信');

CREATE TABLE PHONE_CARRIER_INFO_YD
PARTITION OF PHONE_CARRIER_INFO
FOR VALUES in ('中国移动');

CREATE TABLE PHONE_CARRIER_INFO_DEFAULT
PARTITION OF PHONE_CARRIER_INFO
FOR VALUES in (
'XXX'
);

CREATE UNIQUE INDEX ON phone.PHONE_CARRIER_INFO_LT(PHONE_PREFIX);
CREATE UNIQUE INDEX ON phone.PHONE_CARRIER_INFO_DX(PHONE_PREFIX);
CREATE UNIQUE INDEX ON phone.PHONE_CARRIER_INFO_YD(PHONE_PREFIX);
CREATE UNIQUE INDEX ON phone.PHONE_CARRIER_INFO_DEFAULT(PHONE_PREFIX);


-- suffix
CREATE TABLE PHONE_SUFFIX_4
(
	SUFFIX VARCHAR(4);
);
INSERT INTO PHONE_SUFFIX_4 SELECT '000' || generate_series(0,9)::varchar(4);
INSERT INTO PHONE_SUFFIX_4 SELECT '00' || generate_series(10,99)::varchar(4);
INSERT INTO PHONE_SUFFIX_4 SELECT '0' || generate_series(100,999)::varchar(4);
INSERT INTO PHONE_SUFFIX_4 SELECT generate_series(1000,9999)::varchar(4);

-- generate all
CREATE TABLE PHONE.PHONE_MD5_CARRIER_DEFAULT AS
WITH TMP  as (
SELECT t.PHONE_PREFIX || S.SUFFIX AS PHONE FROM PHONE.PHONE_CARRIER_INFO_DEFAULT t CROSS JOIN PHONE.PHONE_SUFFIX_4 s
) 
SELECT PHONE , UPPER(substring(MD5(PHONE) from 1 for 16)), UPPER(MD5(PHONE)) AS PHONE_MD5 FROM TMP;

